#include <iostream>
#include <fstream>
#include <algorithm>
#include <string>
#include <map>


using namespace std;


/**
 * Skeleton main routine
 */


char chartolower(char c){
  if (65 <= c && c <= 90)
    return c + 32;
  return c;
}


string lower(string s){
  string t;
  transform(s.begin(), s.end(), back_inserter(t), chartolower);
  return t;
}


bool notspace(char c){
  return c != 32 && c != 45;
}


bool space(char c){
  return !notspace(c);
}


vector<string> split(const string s){
  typedef string::const_iterator iter;
  vector<string> words;
  iter i = s.begin();

  while (i != s.end()){
    i = find_if(i, s.end(), notspace);
    iter j = find_if(i, s.end(), space);
    
    if (i != s.end() && string(i, j).size() >= 4)
      words.push_back(string(i, j));
    i = j;
  }
  return words;
}


bool notlowerchar(char c){
  return c <= 97 || c >= 122;
}


string nopunct(string s){
  string::const_iterator iter(remove_if(s.begin(), s.end(), notlowerchar));
  s.erase(iter, s.end());
  return s;
}


int main(int argv, char **argc){
  if (argv > 1){
    ifstream infile(argc[1]);
    string s;
    map<string, int> counter;
    
    while (getline(infile, s)){
      vector<string> words = split(lower(s));
      for_each(words.begin(), words.end(), [&](string t){++counter[nopunct(t)];});
    }

    ofstream outfile("results.txt");
    outfile << "Word\t Usage\n\n";
    for_each(counter.begin(), counter.end(),
	     [&](pair<string, int> p){ outfile << p.first << "\t " << p.second << endl;});
    
  }
  else{
    cout << "Please enter a filename" << endl;
  }
}



